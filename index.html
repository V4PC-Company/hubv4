<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC | Hub de Dados Integrado</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/906/906343.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-dark: #05020a; --sidebar-bg: #0a0414; --card-bg: rgba(20, 10, 35, 0.95);
            --cyan: #00f2ff; --magenta: #ff00e5; --purple: #7000ff; --yellow: #ffd700;
            --bant-color: #ffe600; 
            --border: rgba(0, 242, 255, 0.15); --text-main: #e0e0e0; --text-muted: #8c8c8c;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0414; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--purple); }

        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .spinner { width: 50px; height: 50px; border: 5px solid #333; border-top: 5px solid var(--cyan); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #error-log { display: none; margin-top: 20px; padding: 15px; background: #330000; border: 1px solid red; color: #ff9999; font-family: monospace; font-size: 0.7rem; max-width: 80%; text-align: left; }

        .sidebar { width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px 0; flex-shrink: 0; }
        .brand { padding: 0 20px 30px; display: flex; align-items: center; gap: 10px; font-family: 'Orbitron', sans-serif; color: var(--cyan); font-size: 1rem; letter-spacing: 1px; text-shadow: 0 0 10px rgba(0, 242, 255, 0.3); }
        
        .menu-item { padding: 14px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; color: var(--text-muted); font-size: 0.85rem; transition: 0.3s; border-left: 3px solid transparent; font-weight: 500; }
        .menu-item:hover { background: rgba(255, 255, 255, 0.03); color: #fff; }
        .menu-item.active { color: white; border-left: 3px solid var(--cyan); background: linear-gradient(90deg, rgba(0, 242, 255, 0.1) 0%, transparent 100%); text-shadow: 0 0 8px rgba(255,255,255,0.5); }
        
        .submenu { padding-left: 48px; font-size: 0.8rem; color: #666; position: relative; }
        .submenu::before { content: ''; position: absolute; left: 28px; top: 50%; width: 10px; height: 1px; background: #444; }
        .submenu:hover { color: #fff; }
        .submenu.active { color: var(--cyan); border-left: 3px solid transparent; background: transparent; text-shadow: none; }
        .submenu.active::after { content: '●'; position: absolute; right: 20px; font-size: 0.6rem; color: var(--cyan); }

        .database-btn { margin-top: auto; padding: 20px; background: rgba(255, 0, 229, 0.05); border-top: 1px solid var(--border); cursor: pointer; transition: 0.3s; }
        .database-btn:hover { background: rgba(255, 0, 229, 0.15); }
        .database-btn.active { border-left: 3px solid var(--magenta); color: var(--magenta); }
        
        .main-content { flex: 1; overflow-y: auto; padding: 30px; background: radial-gradient(circle at 10% 10%, #100520 0%, #05020a 100%); display: flex; flex-direction: column; }
        
        .filters-container { background: var(--card-bg); border: 1px solid var(--border); padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        .filter-group { display: flex; flex-direction: column; gap: 5px; flex: 1; min-width: 130px; }
        .filter-group label { font-size: 0.7rem; color: var(--cyan); text-transform: uppercase; font-weight: bold; font-family: 'Inter'; }
        
        .filter-input { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 4px; font-family: 'Inter', sans-serif; font-size: 0.85rem; outline: none; transition: 0.3s; }
        .filter-input:focus { border-color: var(--magenta); box-shadow: 0 0 10px rgba(255, 0, 229, 0.2); }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        
        .btn-filter { height: 40px; margin-top: 18px; background: var(--purple); color: white; border: none; padding: 0 25px; border-radius: 4px; cursor: pointer; font-family: 'Orbitron', sans-serif; transition: 0.3s; }
        .btn-filter:hover { background: var(--magenta); transform: scale(1.05); }

        .dynamic-filter { display: none; min-width: 160px; }
        #group-master label { color: var(--bant-color); }
        #group-master select { border-color: var(--bant-color); color: #fff; }
        #group-year label, #group-quarter label { color: var(--yellow); }
        #group-year select, #group-quarter select { border-color: var(--yellow); color: #fff; }

        .view-section { display: none; animation: fadeIn 0.4s ease; width: 100%; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 25px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.4); }
        .card-header { background: rgba(15, 10, 24, 0.95); padding: 15px 20px; border-bottom: 1px solid var(--border); color: #fff; font-family: 'Inter'; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; font-family: 'Inter'; }
        th { text-align: left; padding: 14px 20px; background: rgba(0, 0, 0, 0.6); color: var(--cyan); border-bottom: 1px solid var(--border); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.75rem; }
        td { padding: 14px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #ccc; vertical-align: middle; }
        tr:hover td { background: rgba(255,255,255,0.02); color: #fff; }

        /* KPIS */
        .summary-bar { display: flex; gap: 20px; margin-bottom: 25px; flex-wrap: wrap; }
        .summary-card { background: #000; border: 1px solid var(--border); border-radius: 8px; padding: 15px 25px; min-width: 150px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        .summary-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, var(--cyan), transparent); }
        .summary-title { color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; font-weight: bold; margin-bottom: 5px; font-family: 'Inter'; letter-spacing: 0.5px; }
        .summary-value { color: #fff; font-size: 2rem; font-family: 'Orbitron'; font-weight: 700; text-shadow: 0 0 15px rgba(255, 255, 255, 0.1); }

        /* GRÁFICOS */
        .overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .chart-container { padding: 20px; }
        .chart-row { display: flex; align-items: center; margin-bottom: 12px; font-size: 0.8rem; }
        .chart-label { width: 100px; color: #aaa; font-weight: 500; }
        .chart-bar-bg { flex: 1; background: #1a1a1a; height: 12px; border-radius: 6px; overflow: hidden; margin: 0 10px; }
        .chart-bar-fill { height: 100%; border-radius: 6px; transition: width 1s; }
        .chart-value { width: 40px; text-align: right; color: #fff; font-weight: bold; }
        
        /* SCALINK */
        .scalink-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .scalink-title { font-size: 1.8rem; font-family: 'Inter'; font-weight: bold; color: white; text-align: center; width: 100%; }
        .scalink-kpi { background: #000; border: 1px solid var(--yellow); border-radius: 6px; padding: 10px 20px; width: 120px; text-align: center; }
        .scalink-kpi-title { color: var(--yellow); font-size: 0.65rem; margin-bottom: 5px; }
        .scalink-kpi-val { color: var(--yellow); font-size: 1.5rem; font-family: 'Orbitron'; font-weight: bold; }
        .scalink-table-container { background: #000; border: 1px solid #333; margin-bottom: 20px; border-radius: 4px; overflow: hidden; }
        .scalink-table th { background: #000; color: var(--yellow); border-bottom: 1px solid #333; font-size: 0.7rem; padding: 10px; text-align: center; }
        .scalink-table td { text-align: center; padding: 8px; font-size: 0.8rem; border-bottom: 1px solid #222; }
        .scalink-row-inactive { background: #8b0000; color: white; }
        .scalink-row-active { background: #2e7d32; color: white; }
        .scalink-row-total { background: #000; color: white; font-weight: bold; }
        .scalink-split-view { display: flex; gap: 20px; height: 500px; }
        .scalink-col { flex: 1; background: #000; border: 1px solid #333; border-radius: 4px; display: flex; flex-direction: column; }
        .scalink-col-header { padding: 10px; background: #000; color: var(--yellow); font-weight: bold; border-bottom: 1px solid #333; text-align: right; font-size: 0.8rem; }
        
        .bar-row { display: flex; align-items: center; padding: 8px 10px; border-bottom: 1px solid #111; font-size: 0.8rem; }
        .bar-label { width: 40px; color: #fff; }
        .bar-track { flex: 1; background: #222; height: 20px; margin: 0 10px; position: relative; }
        .bar-fill { height: 100%; background: #ccc; display: block; }
        .bar-val { width: 30px; text-align: right; color: #ccc; }

        /* TAGS & BADGES */
        .tag-source { font-size: 0.65rem; padding: 4px 10px; border-radius: 4px; text-transform: uppercase; font-weight: 700; margin-right: 8px; display: inline-block; min-width: 50px; text-align: center; letter-spacing: 0.5px; box-shadow: 0 0 5px rgba(0,0,0,0.3); }
        .tag-jul { border: 1px solid #ff0055; color: #ff0055; background: rgba(255, 0, 85, 0.05); }
        .tag-ago { border: 1px solid #ff9100; color: #ff9100; background: rgba(255, 145, 0, 0.05); }
        .tag-set { border: 1px solid #ff00e5; color: #ff00e5; background: rgba(255, 0, 229, 0.05); }
        .tag-out { border: 1px solid #00f2ff; color: #00f2ff; background: rgba(0, 242, 255, 0.05); }
        .tag-nov { border: 1px solid #7000ff; color: #7000ff; background: rgba(112, 0, 255, 0.05); }
        .tag-dez { border: 1px solid #00ff88; color: #00ff88; background: rgba(0, 255, 136, 0.05); }
        .tag-acao { border: 1px solid #ffd700; color: #ffd700; background: rgba(255, 215, 0, 0.05); }
        .tag-ind { border: 1px solid #fff; color: #fff; background: rgba(255, 255, 255, 0.05); }
        .tag-bant { border: 1px solid var(--bant-color); color: var(--bant-color); background: rgba(255, 230, 0, 0.05); }
        .tag-conv { border: 1px solid var(--yellow); color: var(--yellow); background: rgba(255, 215, 0, 0.05); }
        .tag-sca { border: 1px solid #fff; color: #fff; background: #222; }

        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; display: inline-block; white-space: nowrap; max-width: 150px; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; }
        .st-ativo { color: #00ff88; background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.2); }
        .st-inativo { color: #ff4d4d; background: rgba(255, 77, 77, 0.1); border: 1px solid rgba(255, 77, 77, 0.2); }
        .st-negocia { color: #ffd700; background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.2); }
        .st-bant { color: var(--bant-color); background: rgba(255, 230, 0, 0.1); border: 1px solid rgba(255, 230, 0, 0.2); font-weight: bold; }

    </style>
</head>
<body>
    
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div style="font-family:'Orbitron'; color:var(--cyan); letter-spacing:2px;">CONECTANDO BASES...</div>
        <div id="loading-text" style="color:#666; font-size:0.8rem; margin-top:10px;">Iniciando integração segura</div>
        <div id="error-log"></div>
    </div>

    <aside class="sidebar">
        <div class="brand"><i class="fas fa-chart-line"></i> V4 | SCALINK</div>
        
        <div class="menu-item active" onclick="switchTab('page-overview', this)">
            <i class="fas fa-home"></i> VISÃO GERAL
        </div>

        <div class="menu-item" onclick="switchTab('page1', this)">
            <i class="fas fa-layer-group"></i> LEADS GERAIS V4
        </div>
        <div class="menu-item submenu" onclick="switchTab('page2', this)">
            Ações Especiais
        </div>
        <div class="menu-item submenu" onclick="switchTab('page3', this)">
            Agências Individuais
        </div>
        
        <div class="menu-item" onclick="switchTab('page-bant4', this)" style="border-top: 1px solid rgba(255,255,255,0.05);">
            <i class="fas fa-bullseye" style="color: var(--bant-color)"></i> LEADS BANT 4
        </div>

        <div class="menu-item" onclick="switchTab('page-converted', this)">
            <i class="fas fa-check-circle" style="color: var(--yellow)"></i> LEADS CONVERTIDOS
        </div>

        <div class="menu-item" onclick="switchTab('page-scalink', this)">
            <i class="fas fa-chart-pie" style="color: #fff"></i> LEADS TOTAIS SCALINK
        </div>

        <div class="database-btn" onclick="switchTab('page-master', this)">
            <div style="font-family: 'Orbitron'; font-weight: bold; color: var(--magenta); display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-database"></i> BASE GERAL
            </div>
            <div style="font-size: 0.7rem; color: #666; margin-top: 5px;">Visão Consolidada (Full)</div>
        </div>
    </aside>

    <main class="main-content">
        
        <div class="filters-container">
            <div class="filter-group">
                <label>Data Início</label>
                <input type="date" id="inputDateStart" class="filter-input" min="2000-01-01" max="2050-12-31">
            </div>
            <div class="filter-group">
                <label>Data Fim</label>
                <input type="date" id="inputDateEnd" class="filter-input" min="2000-01-01" max="2050-12-31">
            </div>

            <div class="filter-group" style="flex: 2;">
                <label>Buscar (Global)</label>
                <input type="text" id="inputSearch" class="filter-input" placeholder="Nome, email, cliente...">
            </div>

            <div class="filter-group dynamic-filter" id="group-master">
                <label>Master / Região</label>
                <select id="selectMaster" class="filter-input">
                    <option value="">Todos</option>
                </select>
            </div>

            <div class="filter-group dynamic-filter" id="group-year">
                <label>Ano Aprovação</label>
                <select id="selectYear" class="filter-input">
                    <option value="">Todos</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
            </div>

            <div class="filter-group dynamic-filter" id="group-quarter">
                <label>Trimestre</label>
                <select id="selectQuarter" class="filter-input">
                    <option value="">Todos</option>
                    <option value="1ºTRI">1º Trimestre</option>
                    <option value="2ºTRI">2º Trimestre</option>
                    <option value="3ºTRI">3º Trimestre</option>
                    <option value="4ºTRI">4º Trimestre</option>
                </select>
            </div>

            <div class="filter-group">
                <label>Origem</label>
                <select id="selectSource" class="filter-input">
                    <option value="">Todas</option>
                    <option value="JUL">Julho</option>
                    <option value="AGO">Agosto</option>
                    <option value="SET">Setembro</option>
                    <option value="OUT">Outubro</option>
                    <option value="NOV">Novembro</option>
                    <option value="DEZ">Dezembro</option>
                    <option value="BANT4">BANT 4</option>
                    <option value="CONVERTED">Convertidos</option>
                    <option value="SCALINK">Scalink</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Estado (UF)</label>
                <select id="selectUF" class="filter-input">
                    <option value="">Todos</option>
                    <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option>
                    <option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option>
                    <option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option>
                    <option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option>
                    <option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option>
                    <option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option>
                    <option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option>
                    <option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option>
                    <option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Status</label>
                <select id="selectStatus" class="filter-input">
                    <option value="">Todos</option>
                    <option value="Lead tem interesse">Lead tem interesse</option>
                    <option value="Sem retorno">Sem retorno</option>
                    <option value="Declinado internamente">Declinado internamente</option>
                    <option value="Lead declinou">Lead declinou</option>
                    <option value="Em negociação">Em negociação</option>
                    <option value="Processo concluído com êxito">Processo concluído com êxito</option>
                </select>
            </div>
            <button class="btn-filter" onclick="applyFilters()"><i class="fas fa-sync"></i></button>
        </div>

        <section id="page-overview" class="view-section active">
            <div class="summary-bar">
                <div class="summary-card" style="border-bottom: 3px solid var(--cyan);">
                    <div class="summary-title" style="color:var(--cyan)">TOTAL DE LEADS</div>
                    <div class="summary-value" id="ov-total">0</div>
                </div>
                <div class="summary-card" style="border-bottom: 3px solid #00ff88;">
                    <div class="summary-title" style="color:#00ff88">TOTAL ATIVOS</div>
                    <div class="summary-value" id="ov-active">0</div>
                </div>
                <div class="summary-card" style="border-bottom: 3px solid var(--bant-color);">
                    <div class="summary-title" style="color:var(--bant-color)">BANT QUALIFICADOS</div>
                    <div class="summary-value" id="ov-bant">0</div>
                </div>
                <div class="summary-card" style="border-bottom: 3px solid var(--yellow);">
                    <div class="summary-title" style="color:var(--yellow)">CONVERTIDOS</div>
                    <div class="summary-value" id="ov-conv">0</div>
                </div>
            </div>

            <div class="overview-grid">
                <div class="card">
                    <div class="card-header">Distribuição por Origem</div>
                    <div class="chart-container" id="chart-origin"></div>
                </div>
                <div class="card">
                    <div class="card-header">Saúde da Base (Status)</div>
                    <div class="chart-container" id="chart-status"></div>
                </div>
            </div>
        </section>

        <section id="page1" class="view-section">
            <div class="card">
                <div class="card-header">Base Semestral (Julho a Dezembro)</div>
                <div class="table-responsive">
                    <table>
                        <thead><tr><th>Mês</th><th>Nome Completo</th><th>Email</th><th>Localização</th><th>Status</th></tr></thead>
                        <tbody id="table-body-p1"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="page2" class="view-section">
            <div class="card">
                <div class="card-header">Campanha Fim de Ano 2025</div>
                <div class="table-responsive">
                    <table>
                        <thead><tr><th>Origem</th><th>Nome</th><th>Email</th><th>Telefone</th><th>Região</th><th>Status</th></tr></thead>
                        <tbody id="table-body-p2"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="page3" class="view-section">
            <div class="card">
                <div class="card-header">Leads Agências Individuais</div>
                <div class="table-responsive">
                    <table>
                        <thead><tr><th>Origem</th><th>Nome</th><th>Email</th><th>Cidade/UF</th><th>Status</th></tr></thead>
                        <tbody id="table-body-p3"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="page-bant4" class="view-section">
            <div class="card" style="border-color: var(--bant-color);">
                <div class="card-header" style="border-bottom-color: var(--bant-color);">LEADS TOTAIS BANT 4</div>
                <div class="table-responsive">
                    <table>
                        <thead><tr>
                            <th style="color:var(--bant-color)">Cliente</th>
                            <th style="color:var(--bant-color)">Master / Região</th>
                            <th style="color:var(--bant-color)">Telefone</th>
                            <th style="color:var(--bant-color)">Origem do Lead</th>
                            <th style="color:var(--bant-color)">Motivo Encerramento</th>
                            <th style="color:var(--bant-color)">Criado Em</th>
                            <th style="color:var(--bant-color)">Status</th>
                        </tr></thead>
                        <tbody id="table-body-bant4"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="page-converted" class="view-section">
            <div class="card" style="border-color: var(--yellow);">
                <div class="card-header" style="border-bottom-color: var(--yellow);">Leads Convertidos</div>
                <div class="table-responsive">
                    <table>
                        <thead><tr>
                            <th style="color:var(--yellow)">Nome Loja</th>
                            <th style="color:var(--yellow)">Ano Aprovação</th>
                            <th style="color:var(--yellow)">Trimestre</th>
                            <th style="color:var(--yellow)">Status</th>
                            <th style="color:var(--yellow)">Nome Franqueado</th>
                            <th style="color:var(--yellow)">Email</th>
                        </tr></thead>
                        <tbody id="table-body-converted"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="page-scalink" class="view-section">
            <div class="scalink-header">
                <div class="scalink-title">Leads Totais Scalink</div>
            </div>
            <div class="scalink-table-container">
                <table class="scalink-table">
                    <thead><tr><th>Situação</th><th>Lead</th><th>Reunião</th><th>Contato</th><th>Definição</th><th>Comitê</th><th>Multi</th><th>Franq</th><th>Total</th></tr></thead>
                    <tbody id="scalink-funnel-body"></tbody>
                </table>
            </div>
            <div class="scalink-split-view">
                <div class="scalink-col">
                    <div class="scalink-col-header">Lista de Leads</div>
                    <div style="overflow-y:auto; flex:1;"><table style="width:100%;"><tbody id="scalink-list-body"></tbody></table></div>
                </div>
                <div class="scalink-col">
                    <div class="scalink-col-header">Gráfico por Estado</div>
                    <div style="overflow-y:auto; flex:1;" id="scalink-chart-body"></div>
                </div>
            </div>
        </section>

        <section id="page-master" class="view-section">
            <div class="card">
                <div class="card-header">Master Database (Full)</div>
                <div class="table-responsive">
                    <table>
                        <thead><tr><th>Origem</th><th>Nome / Cliente</th><th>Local / Região</th><th>Email / Contato</th><th>Status</th></tr></thead>
                        <tbody id="table-body-master"></tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <script>
        const PROXY_URL = 'https://corsproxy.io/?';
        const SHEET_URLS = {
            JUL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=772320362&single=true&output=csv',
            AGO: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=401963441&single=true&output=csv',
            SET: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=2109863438&single=true&output=csv',
            OUT: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=1372031695&single=true&output=csv',
            NOV: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=1335882778&single=true&output=csv',
            DEZ: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=36750990&single=true&output=csv',
            ACAO: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=410178243&single=true&output=csv',
            IND: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHhCGnGZE8orimuTnbCECn7NqqIoYvcGUHo_6g1A8nbLx56sZT572JdEHpg_uSMQJEYE2uKV4_WUAd/pub?gid=1794727193&single=true&output=csv',
            BANT_MAR: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=248606401&single=true&output=csv',
            BANT_ABR: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=143072328&single=true&output=csv',
            BANT_MAI: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=1603044254&single=true&output=csv',
            BANT_JUN: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=1506135346&single=true&output=csv',
            BANT_JUL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=1984064688&single=true&output=csv',
            BANT_AGO: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=1894726181&single=true&output=csv',
            BANT_SET: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=532605024&single=true&output=csv',
            BANT_OUT: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=71391251&single=true&output=csv',
            BANT_NOV: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=932328819&single=true&output=csv',
            BANT_DEZ: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=2662239&single=true&output=csv',
            BANT_JAN26: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpMZl1dumtMC9i5o3gDJdpzjrcfHwJtJrNe-JJTMZsWdW1Na9hq5f1mACgleTpzDnLks9PkjyaMEmS/pub?gid=467308060&single=true&output=csv'
        };

        const MASTERS_LIST = ["Milene Cristina Bartolli", "Kerolayne Viana", "Ariane Luz da Rocha", "Frederico Omar Castel...", "MG - Julio C. Machado", "Julio C. Machado", "Helio Gomes Cruz Ra...", "Eugênio Monteiro", "Grupo Expansão RJ", "Marcela Monteiro", "PA / MA – Luiz Walter", "AM / RO - Marcio Bar...", "ES - Serguey Junior", "SP-VP-Osasco – Carl...", "AC - Junior Lavor", "GO - Frederico Oma...", "SC - Vanderli Comin...", "RJ - Grupo Expansão...", "PR - Grupo Expansão...", "MS – Otávio Pazin", "RS – Grupo Expansão...", "BA - Marcela Montei...", "MT - Carlos Wolff", "SP Interior - Bruno G..."];

        let masterDB = [];

        window.onload = () => { loadRealData(); populateMasterSelect(); };

        async function loadRealData() {
            const loadingText = document.getElementById('loading-text');
            const keys = Object.keys(SHEET_URLS);
            try {
                const promises = keys.map(async (key) => {
                    loadingText.innerText = `Baixando planilha: ${key}...`;
                    const finalUrl = PROXY_URL + encodeURIComponent(SHEET_URLS[key] + `&_t=${new Date().getTime()}`);
                    const data = await fetchCSV(finalUrl, key);
                    return data.map(row => normalizeData(row, key));
                });
                const results = await Promise.all(promises);
                masterDB = results.flat().filter(item => item.name && item.name !== 'Sem Nome');
                loadingText.innerText = 'Processando dados...';
                applyFilters();
                setTimeout(() => { document.getElementById('loading-overlay').style.opacity='0'; setTimeout(()=>document.getElementById('loading-overlay').style.display='none',500);},500);
            } catch (error) {
                document.getElementById('error-log').style.display='block';
                document.getElementById('error-log').innerText = `Erro: ${error.message}`;
            }
        }

        async function fetchCSV(url) {
            const res = await fetch(url);
            if (!res.ok) throw new Error('HTTP Error');
            const text = await res.text();
            if(text.trim().startsWith('<!DOCTYPE')) throw new Error('HTML retornado');
            return parseCSV(text);
        }

        function parseCSV(text) {
            // CORREÇÃO: PARSER QUE RESPEITA ESPAÇOS E VÍRGULAS DENTRO DE ASPAS
            const lines = text.split('\n').filter(l => l.trim()!=='');
            if(lines.length<2) return [];
            const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g,'').toLowerCase());
            return lines.slice(1).map(line => {
                // Regex melhorado para capturar campos com espaço
                const values = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
                if(!values) return null;
                const obj = {};
                headers.forEach((h, i) => {
                    let val = values[i] || '';
                    val = val.replace(/^"|"$/g, '').replace(/""/g, '"').trim();
                    obj[h] = val;
                });
                return obj;
            }).filter(i => i!==null);
        }

        function normalizeData(row, source) {
            const findKey = (keywords) => Object.keys(row).find(k => keywords.some(kw => k.includes(kw)));
            let finalSource = source.startsWith('BANT') ? 'BANT4' : source;

            // 1. NOME (FORÇA BRUTA: 2ª Coluna ou Busca)
            const values = Object.values(row);
            let name = values[1] || values[0] || 'Sem Nome'; // Pega o valor da 2ª coluna direto

            // 2. MASTER/REGIÃO (Busca o valor completo)
            const regionKey = Object.keys(row).find(k => 
                k.toLowerCase().includes('master') || k.toLowerCase().includes('regi') || k.toLowerCase().includes('consultor')
            );
            let region = row[regionKey] || '-';

            // 3. LOCALIDADE (Tenta montar ou pegar da região)
            const cityKey = findKey(['cidade', 'município', 'local']);
            const ufKey = findKey(['uf', 'estado']);
            let loc = '-';
            if(row[cityKey] && row[ufKey]) loc = `${row[cityKey]} - ${row[ufKey]}`;
            else if(row[cityKey]) loc = row[cityKey];
            else if(row[ufKey]) loc = row[ufKey];
            if(loc === '-' || loc === 'null') loc = region; 

            return {
                source: finalSource,
                name: name,
                email: row[findKey(['email', 'mail'])] || '-',
                phone: row[findKey(['tel', 'cel', 'phone'])] || '-',
                displayLoc: loc,
                city: row[cityKey] || '-',
                uf: row[ufKey] || '-',
                status: row[findKey(['status', 'fase', 'situação'])] || 'Ativo',
                region: region,
                origin: row[findKey(['origem'])] || '-', 
                reason: row[findKey(['motivo', 'encerramento'])] || '-', 
                createdAt: row[findKey(['data', 'date', 'criado'])] || new Date().toISOString().split('T')[0]
            };
        }

        function populateMasterSelect() {
            const s = document.getElementById('selectMaster');
            MASTERS_LIST.forEach(m => { const o=document.createElement('option'); o.value=m; o.innerText=m; s.appendChild(o); });
        }

        function switchTab(pageId, btn) {
            document.querySelectorAll('.view-section').forEach(el=>el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.menu-item, .submenu').forEach(el=>el.classList.remove('active'));
            if(btn.classList.contains('menu-item')||btn.classList.contains('submenu')) btn.classList.add('active');
            
            ['group-master','group-year','group-quarter'].forEach(id=>document.getElementById(id).style.display='none');
            if(pageId==='page-bant4') document.getElementById('group-master').style.display='flex';
            else if(pageId==='page-converted') { document.getElementById('group-year').style.display='flex'; document.getElementById('group-quarter').style.display='flex'; }
        }

        function getSafeValue(id) { const el=document.getElementById(id); return el?el.value.toLowerCase():''; }

        function applyFilters() {
            const search = getSafeValue('inputSearch');
            const source = document.getElementById('selectSource').value;
            const uf = document.getElementById('selectUF').value;
            const statusFilter = getSafeValue('selectStatus');
            const masterFilter = document.getElementById('selectMaster').value;
            const dateStart = document.getElementById('inputDateStart').value;
            const dateEnd = document.getElementById('inputDateEnd').value;

            const filtered = masterDB.filter(item => {
                if(dateStart && dateEnd && item.createdAt && (item.createdAt < dateStart || item.createdAt > dateEnd)) return false;
                if(!item.name.toLowerCase().includes(search) && !item.email.toLowerCase().includes(search)) return false;
                if(source && item.source !== source) return false;
                if(uf && !item.uf.toUpperCase().includes(uf)) return false;
                
                if(statusFilter && statusFilter !== 'todos') {
                    if(!String(item.status).toLowerCase().includes(statusFilter)) return false;
                }

                if(masterFilter && !String(item.region).includes(masterFilter)) return false;
                return true;
            });

            renderViews(filtered);
            renderOverview(filtered);
        }

        function renderOverview(data) {
            document.getElementById('ov-total').innerText = data.length;
            document.getElementById('ov-active').innerText = data.filter(i => String(i.status).toLowerCase().match(/interesse|negociação|êxito/)).length;
            document.getElementById('ov-bant').innerText = data.filter(i => i.source === 'BANT4').length;
            document.getElementById('ov-conv').innerText = data.filter(i => i.source === 'CONVERTED').length;

            const counts = {}; data.forEach(i => counts[i.source]=(counts[i.source]||0)+1);
            const prettyNames = { 'IND': 'AG. INDIVIDUAIS', 'ACAO': 'AÇÃO FIM ANO', 'BANT4': 'BANT 4', 'CONVERTED': 'CONVERTIDOS' };
            
            document.getElementById('chart-origin').innerHTML = Object.entries(counts).sort((a,b)=>b[1]-a[1]).map(([k,v])=>{
                const pct = (v/data.length)*100;
                return `<div class="chart-row"><div class="chart-label" style="width:120px;">${prettyNames[k]||k}</div><div class="chart-bar-bg"><div class="chart-bar-fill" style="width:${pct}%; background:var(--cyan);"></div></div><div class="chart-value">${v}</div></div>`;
            }).join('');

            const stCounts = {}; 
            data.forEach(i => { 
                let s = String(i.status).toUpperCase().trim();
                // LIMPEZA: Remove "5", "null", "-", números
                if(!s || s==='NULL' || s==='-' || !isNaN(s) || s.length<3) return;
                if(s.length>20) s=s.substring(0,20)+'...';
                stCounts[s] = (stCounts[s]||0)+1; 
            });
            
            document.getElementById('chart-status').innerHTML = Object.entries(stCounts).sort((a,b)=>b[1]-a[1]).slice(0,6).map(([k,v])=>{
                const pct = (v/data.length)*100;
                return `<div class="chart-row"><div class="chart-label" style="width:120px;">${k}</div><div class="chart-bar-bg"><div class="chart-bar-fill" style="width:${pct}%; background:#00ff88;"></div></div><div class="chart-value">${v}</div></div>`;
            }).join('');
        }

        function renderViews(data) {
            const p1 = data.filter(i=>['JUL','AGO','SET','OUT','NOV','DEZ'].includes(i.source));
            renderTable('table-body-p1', p1, i=>`<td><span class="tag-source tag-${i.source.toLowerCase()}">${i.source}</span></td><td><b>${i.name}</b></td><td>${i.email}</td><td>${i.displayLoc}</td><td>${getStatusBadge(i.status)}</td>`);
            
            const p2 = data.filter(i=>i.source==='ACAO');
            renderTable('table-body-p2', p2, i=>`<td><span class="tag-source tag-acao">FIM ANO</span></td><td><b>${i.name}</b></td><td>${i.email}</td><td>${i.phone}</td><td>${i.displayLoc}</td><td>${getStatusBadge(i.status)}</td>`);
            
            const p3 = data.filter(i=>i.source==='IND');
            renderTable('table-body-p3', p3, i=>`<td><span class="tag-source tag-ind">IND</span></td><td><b>${i.name}</b></td><td>${i.email}</td><td>${i.displayLoc}</td><td>${getStatusBadge(i.status)}</td>`);
            
            const p4 = data.filter(i=>i.source==='BANT4');
            renderTable('table-body-bant4', p4, i=>`<td>${i.name}</td><td>${i.region}</td><td>${i.phone}</td><td>${i.origin}</td><td><span class="st-bant">${i.reason}</span></td><td>${i.createdAt}</td><td>${getStatusBadge(i.status)}</td>`);
            
            renderTable('table-body-master', data, i=>`<td><span class="tag-source tag-${i.source.toLowerCase().substring(0,3)}">${i.source}</span></td><td><b>${i.name}</b></td><td>${i.displayLoc}</td><td>${i.email} <br><small style="color:#666">${i.phone}</small></td><td>${getStatusBadge(i.status)}</td>`);
        }

        function renderTable(id, data, tpl) {
            document.getElementById(id).innerHTML = data.length ? "" : "<tr><td colspan='10' style='text-align:center; padding:30px; opacity:0.5;'>Nenhum registro encontrado.</td></tr>";
            data.forEach(item => { const tr = document.createElement('tr'); tr.innerHTML = tpl(item); document.getElementById(id).appendChild(tr); });
        }

        function getStatusBadge(status) {
            const s = String(status).toLowerCase();
            let className = '';
            if(s.match(/interesse|êxito|implantação|ativo/)) className = 'st-ativo';
            else if(s.match(/sem retorno|declinou|inativo|perdido/)) className = 'st-inativo';
            else if(s.match(/negociação/)) className = 'st-negocia';
            return `<span class="status-badge ${className}">${status}</span>`;
        }

        ['inputSearch', 'selectSource', 'selectUF', 'selectStatus', 'selectMaster', 'selectYear', 'selectQuarter', 'inputDateStart', 'inputDateEnd'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.addEventListener(id.includes('input') ? 'input' : 'change', applyFilters);
        });
    </script>
</body>
</html>
